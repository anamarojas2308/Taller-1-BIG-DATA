#INTRODUCCIÓN: La subdeclaración de ingresos es un problema recurrente en la recaudación de impuestos, contribuyendo a la evasión fiscal. Por lo cual, se considera necesario un modelo de predicción de ingresos para detectar fraudes y asistir a personas vulnerables que necesiten focalización y desarrollo de políticas públicas. Por un lado, el nivel de ingresos en el mercado laboral es clave en la economía y en la formulación de políticas públicas, ya que influye en la distribución de la riqueza y en la calidad de vida de la población. Diversos estudios han analizado cómo factores como la edad, el género, el nivel educativo y el estrato socioeconómico afectan los ingresos de los trabajadores. Este trabajo busca explorar la relación entre estas variables y los salarios, con un énfasis particular en la estructura de los ingresos por hora. Para ello, se utiliza una amplia base de datos representativa de trabajadores en Bogotá, la cual permite examinar patrones de ingreso en función de la edad, el género, la educación, el estrato socioeconómico y la formalidad. Se emplean diversas herramientas estadísticas y visualizaciones para identificar tendencias y disparidades en los ingresos, y en particular, se modela el salario por hora en términos logarítmicos para evaluar la relación no lineal con la edad, considerando efectos decrecientes del salario a medida que aumenta la experiencia laboral. El estudio confirma la importancia de la educación y la experiencia en la determinación de los salarios y resalta las desigualdades estructurales existents en el mercado laboral. Estos hallazgos tienen implicaciones importantes para el diseño de políticas públicas orientadas a la reducción de la desigualdad y la mejora de las condiciones laborales. Por el otro lado, los modelos estadísticos buscan estimar cuánto debería ganar un individuo en función de variables como edad, educación, tipo de empleo y sector económico. Si el ingreso declarado por una persona es significativamente menor al valor predicho por el modelo, podría ser un indicio de subdeclaración de ingresos. De este modo, los contribuyentes que reportan ingresos inusualmente bajos dentro de su grupo de referencia pueden ser marcados para auditoría (outliers). Con ayuda de modelos de predicción, análisis de outliers, comparación con bases de datos externas y modelos de machine learning se logra detectar el fraude fiscal.

#PUNTO 2A: #Describir brevemente la data: #Una vez se combinan los datos
y se obtiene la base completa, se evidencia que hay información que nos
permite analizar el mercado laboral y variables ecónomicas de diferentes
individios. Se encuentra que el objetivo principal de la base de datos
es analizar ingresos (salario) y comportamientos del mercado. Hay
variables que nos permiten analizar características individuales como la
edad, género, educación, departamento, entre otras y variables que se
relacionan con la actividad laboral como los ingresos, horas trabajadas,
tipo de empleo, sector económico, entre otras. La selección de las
variables es clave puesto que permitirá evaluar los factores que
influyen en el ingreso y analizar fenómenos como la brecha salarial de
género. De igual forma, es importante mencionar que la base tiene
valores faltantes y observaciones con ingreso igual a cero, lo que
sugiere la necesidad de un proceso de limpieza antes del análisis. La
base tiene una estructura de formato tabular, la cual facilita el
procesamiento de los datos y el análisis de los mismos mediante
descripciones estadísticas. Adicionalmente, se considera que los datos
proporcionados son fundamentales para construir un modelo predictivo de
ingresos por hora y detectar como variables sociodemográficas y
laborales inciden en la remuneración de los individuos.

2b. #Proceso y dificultades accediendo a la data: #En primer
lugar hay que tener presente que los datos no se pueden descargar como
un archivo, sino que se encuentran en un página web
(<https://ignaciomsarmiento.github.io/GEIH2018_sample/>), por lo cual,
es necesario hacer web scrapping para extraerlos. Los datos estaban
distribuidos en diferentes sitios web, por lo se combinaron en un único
conjunto de datos. De esta forma, se difinió la base de la URL, donde
cada página se nombró siguiendo un patrón (geih_page_1.html",
"geih_page_2.html ..., etc). Con ayuda de la libreria rvest se leyó el
contenido HTML de cada página (data chunk 1:10), se extrajeron las
tablas y se combinaron los datos en un solo dataframe, almacenando el
resultado en la variables datos_totales. Para evitar que el código fuese
a generar error en caso de que una de las páginas no cargara
correctamente, se utilizó tryCatch (manejo de errores). De esta forma,
se buscaba que si las páginas cargaban correctamente, se extrayera las
tablas y se añadieran a la variable "datos_totales" y si se llegaba a
presentar algún problema de lectura, se captaría el error sin detener la
ejecución total. Por lo tanto, el código permite automatizar el proceso
de recolección de datos que están distribuidores en diferentes sitios
web y cuando se trabaja con grandes volúmenes de datos, aún si se
presenta algún problema. No se encuentran restricciones dado que la
página no tiene capchas ni bloqueos para la extracción de datos, pero
tuvimos presente no hacer múltiples solicitudes en un corto período de
tiempo para no sobrecargar el servidor. Por el otro lado, los datos son
públicos y fueron diseñados para fines académicos, por lo que facilito
en gran medida el scrapping.

2c.#En primer lugar, se consideró necesario renombrar ciertas variables como edad, sexo, ingreso total para facilidad de lectura del grupo y se creó una variable "ln_Salario_hora", a la cual se le aplicó logarítmo natural para facilitar el análisis de regresión posterior. De acuerdo al enunciado del problem set, se identificó qué debíamos filtrar la base por aquellos individuos empleados mayores de 18 años. Por lo cual, se filtraron los datos para las muestras mayores a 18 años, donde el ingreso total fuese mayor a cero y tanto las horas trabajadas como el salario por hora fuese mayor a cero. Adicionalmente, se identificaron y eliminaron outliers extremos para las variables de horas trabajadas y salario por hora usando percentiles 1% y 99% con el fin de que dichos valores atípicos distorsionen las interpretaciones de los resultados. Posteriormente, se seleccionaron únicamente variables númericas y se elimnaron aquellas con desviación estándar igual a cero, puesto que no aporta variabilidad al modelo. Asimismo, las variables NA dado que no tienen información útil. Teniendo en cuenta que la base completa era bastante amplia, se decidió calcular la correlación de cada variable numérica con Salario_hora y de esta forma, se seleccionaron las 25 variables con mayor correlación puesto que serían las más relevantes para analizar. Adicionalmente, se consideraron otras variables como la edad, el género, etc  dado que estas variables han sido ampliamente estudiadas en investigaciones económicas y del mercado laboral, demostrando efectos significativos en los ingresos. De este modo, las variables relevantes para el análisis son de características individuales (edad, genero, educación (college, maxEducLeval)), características laborales (oficio, informalidad, horas trabajadas), características económicas (ingresos, estrato) y así se crea un nuevo dataframe con solo estas variables para reducir la dimensionalidad de la base. 

2d. (analisis estadisticas descriptivas). La tabla #1 corresponde a las estadísticas descriptivas de las variables seleccionadas (aquellas con una correlación significativa y aquellas ampliamente estudiadas). En primer lugar, se analizan las variables demográficas. Se evidencia que los individuos están entre los 19 y los 86 años de edad, con una media de 36.3 años lo que sugiere que la muestra poblacional está en edad laboral. La media de la variable de género (hombre) es de 0.5038, lo que indica que hay una distrinución equilibrada entre hombres y mujeres. A partir de la variable  maxEducLevel se evidencia que la mayoría de la población tiene al menos educación secundaria o técnica, dado que la media es 6 y a partir de college se evidencia que el alrededor del 35% de la muestra ha alcanzado la educación superior (universitaria), dado que la media es de 0.3474. De esta forma, se puede concluir que la muestra incluye una población trabajadora en su mayoría joven-adulta, con igualdad de representación entre hombres y mujeres y un nivel educativo medio-alto. En segundo lugar, se analizan las variables laborales y se encuentra a partir de la variable "informal" que el 21.41% de la muestra está en el sector informal (informal = 0.2141), mientras que el 78.59% está en el sector formal (formal = 0.7859). Adicionalmente, se encuentra por medio de la variable "hoursWorkUsual" que la mayoría trabaja jornadas laborales completas puesto que la media es de 48.13 horas y que no hay individuos independientes dado que la media de la variable "cuenta propia" es cero. En tercer lugar, se analizan las variables económicas y se encuentra la variable de Salario por hora, la cual tiene un rango de 1,215 a 58,333, con una mediana de 4,555 y una media de 7,291.La gran diferencia entre media y mediana sugiere que hay valores extremos que elevan el promedio. La variable de ingreso total(ingtotes) muestra una gran dispersión en los valores, con un máximo de 8 millones. La media (434,783) es significativamente mayor a la mediana (191,834), indicando la presencia de ingresos muy elevados en la parte alta de la distribución y, por medio de Logaritmo del salario (ln_Salario_hora) se evidencia que los ingresos siguen una distribución normal. Es decir, los ingresos presentan una fuerte dispersión y una distribución sesgada con valores muy altos en la parte superior. Esto refuerza la necesidad de usar el logaritmo del salario en los modelos de regresión para reducir heterocedasticidad. Finalmente, se analizan las variables sociales y se encuentra a partir de la variable de estrato socioeconómico que la población está en estratos medios-bajos pues la media es de 2.491. Sin embargo, se encuentra un máximo de 6, lo que refleja la diversidad de condiciones socioeconómicas en la muestra. Finalmente, por medio de la variable (cotPension), se evidencia que la mayoría de los trabajadores están afiliados a pensión pues la media de 1.232 indica que más del 50% cotiza. De esta forma, el acceso a la seguridad social está presente en una parte importante de la población, pero es posible que una proporción significativa no cotice. La distribución de estratos refleja la heterogeneidad económica en Bogotá. En conclusión, la población trabajadora se compone principalmente por adultos jóvenes con una distribución casi equitativa entre hombres y mujeres. La mayoría de los trabajadores están en el sector formal y con jornadas laborales completas, aunque hay presencia de informalidad y posibles casos de sobreempleo. Los ingresos presentan una alta dispersión, con valores extremos que sesgan la media hacia valores elevados.Existe una diversidad en niveles educativos y estratos socioeconómicos, lo que puede ser clave en la modelización del salario.

2d. (graficos) Para completar el análisis de las estadísticas descriptivas, se consideró pertinente ver la relación gráfica entre la variable salario y otras variables de interés como las mencionadas anteriormente. La primera relación que encontramos es la de la Figura 1. "Age-Earnings Profile", en el que se muestra la relación entre la edad y el salario por hora estimado. Se observa una curva en forma de U cóncava, lo que sugiere que los ingresos tienden a aumentar con la edad hasta un punto máximo alrededor de los 45-50 años y luego disminuyen progresivamente. Esto puede explicarse por la acumulación de experiencia y educación en la primera mitad de la vida laboral, seguida por una posible reducción en la intensidad del trabajo, jubilación o cambios en el tipo de empleo en una edad mayor. En la Figura 2."Ingresos promedio por grupo de edad y género", se evidencian los ingresos promedio por grupo de edad y se diferencia entre hombres (azul) y mujeres (rojo). Se analiza que en la mayoría de los grupos de edad, los hombres tienden a tener ingresos más altos que las mujeres, aunque en algunos rangos (como 40-50 años) la diferencia es menor. Hay una tendencia similar al primer gráfico, donde los ingresos crecen con la edad hasta un punto máximo entre 40-60 años y luego disminuyen en el grupo de mayores de 70 años. El grupo de menores de 20 años, tiene los ingresos más bajos, lo cual tiene sentido puesto que están en etapas de educación o comenzando la carrera laboral. Ambos gráficos reflejan una relación clara entre la edad y los ingresos, con un punto máximo alrededor de los 40-50 años y una posterior disminución. También se observa una brecha de género en los ingresos, con los hombres ganando más en la mayoría de las edades. Esto puede estar influenciado por diferencias en acceso a empleos mejor remunerados, interrupciones laborales en el caso de las mujeres (embarazo) y otros factores estructurales del mercado laboral. En la Figura 3. "Ingresos promedio por estrato" se muestra la relación entre el estrato socioeconómico y el ingreso promedio de la muestra poblacional. Se observa una relación positiva entre estrato e ingresos, puesto que a medida que el estrato aumenta, el ingreso promedio también crece. Esto es posible, ya que los estratos más altos suelen tener acceso a mejores oportunidades económicas y educativas. Sin embargo, se evidencia una gran diferencia entre el estrato 1 (el más bajo) y los estratos superiores. Por ejemplo, el estrato 1 tiene ingresos muy bajos en comparación con el estrato 2, que experimenta un fuerte incremento.Los estratos 5 y 6 tienen ingresos similares, por lo que no se observa un aumento significativo entre estos dos estrato. Esto indica que, a partir de cierto punto, el crecimiento del ingreso se estabiliza.Este gráfico refleja la desigualdad económica y cómo el acceso a recursos (vivienda, educación) influye en los ingresos. La Figura 4. " Ingresos promedio por nivel de educación" muestra cómo el nivel educativo impacta en el ingreso promedio, diferenciando entre hombres (azul) y mujeres (rojo).Se evidencia una clara relación positiva entre el nivel educativo y el ingreso promedio. Aquellos con mayor nivel de estudios obtienen ingresos significativamente más altos. Asimismo, se evidencia que en los niveles educativos más bajos, las diferencias salariales entre hombres y mujeres se perciben, mientras que a medida que aumenta el nivel educativo, las diferencias de género se reducen, especialmente en los niveles más altos donde los ingresos parecen igualarse. El salto en ingresos entre los niveles educativos bajos y altos es notable. La diferencia entre los que tienen poca educación y los que alcanzan niveles universitarios es muy marcada.Este gráfico refuerza la importancia de la educación como un determinante clave de los ingresos y sugiere que una mayor escolaridad puede ser una vía para mejorar las condiciones económicas. En la Figura 6. "Salario-hora por horas de trabajo" se muestra la relación entre las horas de trabajo (eje X) y el salario por hora (eje Y), diferenciando entre trabajadores formales (azul) e informales (rojo).Principalmente, se observa que los trabajadores formales tienden a tener salarios por hora más altos, con una mayor dispersión de valores en la parte superior del gráfico, mientras que los trabajadores informales se concentran en los niveles más bajos de salario por hora, con pocos casos de ingresos altos. Asimismo, se observa que la mayoría de los trabajadores se agrupan entre 30 y 60 horas semanales. No hay una clara tendencia de aumento del salario por hora con más horas trabajadas, lo que indica que la cantidad de horas no garantiza mejores ingresos. Finalmente, se observa que hay trabajadores informales con techo de ingresos dado que casi todos los puntos rojos están en la parte baja del gráfico, lo que indica que presentan limitaciones salariales y no alcanzan los mismo niveles salariales que los trabajadores formales.Por último, se analiza la Figura 9. "Boxplot promedio de ingresos por estrato", la cual muestra la distribución de los ingresos promedio en función del estrato socioeconómico. Se encuentra una tendencia creciente de ingresos con respecto al estrato. Los estratos más bajos (1, 2 y 3) tienen ingresos considerablemente menores y con menor dispersión, mientras que los estratos altos (4, 5 y 6) presentan ingresos más elevados y una mayor variabilidad. Por otro lado, se encuentra que en los estratos 1, 2 y 3, los ingresos están muy concentrados en valores bajos, con algunas excepciones representadas por los outliers. A partir del estrato 4, la mediana de los ingresos aumenta notablemente y la dispersión de los datos es mucho mayor. El estrato 6 tiene la distribución más amplia, lo que indica una mayor diferencia entre quienes ganan poco y quienes ganan mucho dentro de este grupo. Es importante mencionar que se observan outliers en todos los estratos, pero en los más bajos estos outliers son menos frecuentes y no tan extremos, mientras que en los estratos más altos, la presencia de valores atípicos con ingresos significativamente altos sugiere que hay grupos reducidos de personas con ingresos muy elevados. De esta manera, se puede concluir que hay una fuerte relación entre variables socioeconómicas y los ingresos de la población. Se observa que el nivel de ingresos aumenta con la edad hasta cierto punto, mostrando un pico, con diferencias notables entre hombres y mujeres. Asimismo, el estrato socioeconómico y el nivel educativo tienen un impacto significativo en los ingresos, donde los estratos altos y las personas con mayor nivel educativo perciben salarios más elevados. Además, el mercado laboral presenta disparidades entre el empleo formal e informal, con trabajadores formales obteniendo mayores salarios por hora, aunque con una variabilidad considerable. Finalmente, la distribución de ingresos refleja altos niveles de desigualdad, especialmente en los estratos más altos, donde hay una mayor dispersión y presencia de outliers con ingresos significativamente altos. Estos resultados demuestran la importancia de desarrollar políticas públicas que promuevan el acceso a la educación y la formalización del empleo como estrategias clave para reducir las brechas económicas y laborales.

Analisis 3: La primera tabla muestra la estimación de un modelo de regresión para explicar el logaritmo del salario por hora (ln_salario_hora) en función de la edad y la edad al cuadrado. En primer lugar, se analiza el coeficiente "edad", donde edad = 0.054, p<0.01. Se encuentra que por cada año adicional de edad, el salario por hora aumenta 5,4%, manteniendo constantes las demás variables. El error estándar es pequeño (0.003), lo que sugiere que la estimación es precisa. Dado que el coeficiente es estadísticamente significativo a un nivel del 1% (p<0.01), hay fuerte evidencia de que la edad tiene un impacto positivo en los salarios por hora. En segundo lugar, se analiza la edad al cuadrado, donde edad_squared = -0.001, p<0.01. El coeficiente negativo sugiere que, a medida que aumenta la edad, el crecimiento del salario por hora se desacelera. Es decir, la relación entre edad e ingresos sigue una curva cuadrática (cóncava), lo que indica que hay un punto máximo a partir del cual los salarios dejan de crecer y comienzan a disminuir. También es significativo a un nivel del 1% (p<0.01), lo que confirma que esta relación cuadrática es relevante en el modelo. La constante igual a 7.527 representa el valor de ln_salario_hora cuando edad = 0. Su valor elevado sugiere que, en términos logarítmicos, los salarios de referencia sin considerar la edad son relativamente altos. Por otro lado, se considera necesario analizar los indicadores estadísticos del modelo. Por ejemplo, observamos que la muestra usada en la estimación del modelo incluye 9423 individuos. El R² indica que el modelo solo explica el 3.5% (0.035) de la variabilidad en los salarios por hora, lo cual nos indica que hay otros factores importantes que determinan el salario y que no están incluidos en el modelo como educación, experiencia o sector de empleo. El error estándar residual (0.634) muestra la dispersión de los errores del modelo, indicando qué tan lejos están los valores reales de los valores predichos en promedio. Finalmente, se logra concluir que el modelo es globalmente significativo dado que valor p del Estadístico F es menos a 0.01 se logra rechazar la hipótesis nula de que todos los coeficientes son iguales a cero. Siendo así, el modelo sugiere que el salario por hora aumenta con la edad, pero a un ritmo decreciente, alcanzando un punto máximo antes de empezar a disminuir. Sin embargo, el bajo R² indica que la edad por sí sola no es un buen predictor del salario y que se necesitan otras variables (como nivel educativo, experiencia, género, sector laboral, etc.) para explicar mejor la variabilidad en los ingresos.
